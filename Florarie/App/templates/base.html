{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flower Joy</title>
    <script src="https://unpkg.com/htmx.org@1.9.5"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Lora:wght@400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400..700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet"> <!-- Indie Flower font -->

    <link href="{% static 'output.css' %}" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    {% csrf_token %}
    <meta name="csrf-token" content="{{ csrf_token }}">
</head>

<style>
  
.font-dancing {
    font-family: 'Dancing Script', cursive;
}
.font-indie {
    font-family: 'Indie Flower', cursive;
}
.glass {
    position: absolute;
    top: 55%;
    left: -50%;
    transform: translateY(-50%);
    width: 30%;
    height: 40%;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 10px;
    backdrop-filter: blur(10px);
    transition: left 0.5s ease-in-out;
}
.glass.active {
    left: 10%;
}

/* Remove number input arrows */
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
    -webkit-appearance: none;
    margin: 0;
}

input[type="number"] {
    -moz-appearance: textfield;
}

/* .bg-selected {
    @apply bg-primary/10 ring-2 ring-primary font-semibold;
} */


/* price ranger */

    /* Hide default range styling */
    input[type="range"] {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        position: absolute;
        background: transparent;
        pointer-events: none;
        z-index: 2;
        left:0;
    }

    /* Custom track (hidden default) */
    input[type="range"]::-webkit-slider-runnable-track {
        height: 2px;
    }

    /* Custom thumb styling (Centered) */
    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 18px;
        height: 18px;
        background: white;
        border: 3px solid;
        border-radius: 50%;
        cursor: pointer;
        pointer-events: auto;
        position: relative;
        z-index: 3;
        transform: translateY(-40%);
    }

    input[type="range"]::-moz-range-thumb {
        width: 18px;
        height: 18px;
        background: white;
        border: 3px solid ;
        border-radius: 50%;
        cursor: pointer;
        pointer-events: auto;
        z-index: 3;
        transform: translateY(-40%);
    }

    /* Centering the range input itself */
    .slider-container {
        position: relative;
        height: 10px; /* Adjust height to fit thumb */
    }

</style>

<body class="bg-gray font-serif min-h-screen flex flex-col">

    <!-- Navbar -->
    {% include 'partials/navbar.html' %}  

    <!-- Main Content -->
    <main class="flex-grow h-full">
        {% block content %}
        {% endblock %}
    </main>
    
    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4 flex justify-between">
            <p>&copy; 2025 Your Flower Shop. All rights reserved.</p>
            <div>
                <a href="#" class="text-gray-400 mx-2">Facebook</a>
                <a href="#" class="text-gray-400 mx-2">Instagram</a>
                <a href="#" class="text-gray-400 mx-2">Twitter</a>
            </div>
        </div>
    </footer>

</body>

<meta name="stripe-key" content="{{ stripe_public_key }}">

<script src="https://js.stripe.com/v3/"></script>
<script>
    const stripe = Stripe("pk_test_51R8NtNRsvYugeMjUdh0qycRIsQ6qcSW2dfu2eZQiPpJ4Jf4k0xZf6AWkIkg1aNxnlC8mVDFlu9LribT35lEW2oIw00uXLxKHes");
    let card = null;

    document.body.addEventListener('htmx:afterSwap', function (evt) {
    const target = evt.detail.target;

    if (target.querySelector('#card-element') && stripe) {
        if (document.querySelector('#payment-form').dataset.initialized === "true") return;
        document.querySelector('#payment-form').dataset.initialized = "true";

        const elements = stripe.elements();
        card = elements.create("card");
        card.mount("#card-element");

        const form = document.querySelector("#payment-form");
        form.addEventListener("submit", function (e) {
            e.preventDefault();

            stripe.createToken(card).then(function (result) {
                if (result.error) {
                    document.getElementById("card-errors").textContent = result.error.message;
                } else {
                    const hiddenInput = document.createElement("input");
                    hiddenInput.setAttribute("type", "hidden");
                    hiddenInput.setAttribute("name", "stripeToken");
                    hiddenInput.setAttribute("value", result.token.id);
                    form.appendChild(hiddenInput);

                    htmx.ajax('POST', '/checkout/step-3/', {
                        target: '#checkout-section',
                        swap: 'outerHTML',
                        values: {
                            stripeToken: result.token.id,
                            csrfmiddlewaretoken: form.querySelector('[name=csrfmiddlewaretoken]').value
                        }
                    });
                }
            });
        });
    }
});

</script>


<script>

    //script for make your own page
    document.addEventListener("DOMContentLoaded", () => showStep("step-shape"));

    function showStep(stepId) {
        // Hide all steps
        document.querySelectorAll('.step').forEach(step => {
            step.classList.add('hidden');
        });

        // Show selected step
        document.getElementById(stepId).classList.remove('hidden');

        // Update button highlighting
        document.querySelectorAll('.step-button').forEach(btn => {
            btn.classList.remove('bg-primary/10', 'ring-2', 'ring-primary', 'font-semibold');
        });

        const activeBtn = document.querySelector(`[data-step-button="${stepId}"]`);
        if (activeBtn) {
            activeBtn.classList.add('bg-primary/10', 'ring-2', 'ring-primary', 'font-semibold');
        }
    }


   function incrementValue(inputId) {
        const input = document.getElementById(inputId);
        const currentValue = parseInt(input.value);
        const maxValue = parseInt(input.max);

        if (input && currentValue < maxValue) {
            input.value = currentValue + 1;
            input.dispatchEvent(new Event('change', { bubbles: true }));
        }
    }

    function decrementValue(inputId) {
        const input = document.getElementById(inputId);
        const currentValue = parseInt(input.value);
        const minValue = parseInt(input.min);

        if (input && currentValue > minValue) {
            input.value = currentValue - 1;
            input.dispatchEvent(new Event('change', { bubbles: true }));
        }
    }
</script>

<script>
    document.body.addEventListener('htmx:configRequest', (event) => {
        const token = document.querySelector('meta[name="csrf-token"]').content;
        event.detail.headers['X-CSRFToken'] = token;
    });
</script>

<script>
    document.body.addEventListener('htmx:targetError', function(evt) {
        console.error("HTMX Target Error:", evt.detail);
    });

    document.body.addEventListener('htmx:afterRequest', function(evt) {
        console.log("HTMX request completed", evt.detail);
    });
</script>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function () {
  fetch("{% url 'analytics_data' %}")

    .then(res => res.json())
    .then(data => {
      new Chart(document.getElementById("salesChart"), {
        type: "line",
        data: {
          labels: data.sales.labels,
          datasets: [
            {
              label: "Sales ($)",
              data: data.sales.totals,
              borderColor: "rgb(59, 130, 246)",
              backgroundColor: "rgba(59, 130, 246, 0.1)",
              fill: true,
              tension: 0.4,
            }
          ]
        },
        options: { responsive: true }
      });

      new Chart(document.getElementById("productsChart"), {
        type: "bar",
        data: {
          labels: data.top_products.labels,
          datasets: [{
            label: "Units Sold",
            data: data.top_products.data,
            backgroundColor: "rgba(34, 197, 94, 0.5)",
            borderColor: "rgba(34, 197, 94, 1)",
            borderWidth: 1
          }]
        },
        options: { responsive: true }
      });

      // Conversion Rate Chart
      const ctx3 = document.getElementById('visitorsChart');
      if (document.getElementById('visitorsChart')) {
        new Chart(ctx3, {
          type: 'bar',
          data: {
            labels: data.visits.labels,
            datasets: [{
              label: 'Visitors',
              data: data.visits.counts,
              backgroundColor: 'rgba(16, 185, 129, 0.5)',
              borderColor: 'rgb(5, 150, 105)',
              borderWidth: 1
            }]
          },
          options: { responsive: true }
        });
      }

      // Conversion Rate Chart
      const conversionChartEl = document.getElementById('conversionChart');
      if (conversionChartEl) {
        new Chart(conversionChartEl, {
          type: 'line',
          data: {
            labels: data.conversion.labels,
            datasets: [{
              label: 'Conversion Rate (%)',
              data: data.conversion.rates,
              borderColor: 'rgb(234, 88, 12)',
              backgroundColor: 'rgba(251, 191, 36, 0.2)',
              fill: true,
              tension: 0.4,
              yAxisID: 'y',
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                title: { display: true, text: 'Conversion Rate (%)' }
              }
            }
          }
        });
      }
    });
});
</script>